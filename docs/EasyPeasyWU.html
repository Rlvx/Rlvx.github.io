<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Easy Peasy</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="writup-de-double-des---picoctf">Writup de Easy Peasy - PicoCTF</h1>
<h3 id="description-initiale-">Description initiale :</h3>
<p>A one-time pad is unbreakable, but can you manage to recover the flag? (Wrap with picoCTF{}) <code>nc mercury.picoctf.net 36981</code>  <a href="https://mercury.picoctf.net/static/6920807ae08f883dbb50f6f301f92684/otp.py">otp.py</a></p>
<h3 id="programme-otp.py-">Programme <a href="https://mercury.picoctf.net/static/6920807ae08f883dbb50f6f301f92684/otp.py">otp.py</a> :</h3>
<pre class=" language-python"><code class="prism  language-python"><span class="token comment">#!/usr/bin/python3 -u</span>
<span class="token keyword">import</span> os<span class="token punctuation">.</span>path

KEY_FILE <span class="token operator">=</span> <span class="token string">"key"</span>
KEY_LEN <span class="token operator">=</span> <span class="token number">50000</span>
FLAG_FILE <span class="token operator">=</span> <span class="token string">"flag"</span>

<span class="token keyword">def</span> <span class="token function">startup</span><span class="token punctuation">(</span>key_location<span class="token punctuation">)</span><span class="token punctuation">:</span>
	flag <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>FLAG_FILE<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
	kf <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>KEY_FILE<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

	start <span class="token operator">=</span> key_location
	stop <span class="token operator">=</span> key_location <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

	key <span class="token operator">=</span> kf<span class="token punctuation">[</span>start<span class="token punctuation">:</span>stop<span class="token punctuation">]</span>
	key_location <span class="token operator">=</span> stop

	result <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> p<span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token string">"{:02x}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">^</span> k<span class="token punctuation">)</span><span class="token punctuation">,</span> flag<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"This is the encrypted flag!\n{}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> key_location

<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>key_location<span class="token punctuation">)</span><span class="token punctuation">:</span>
	ui <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"What data would you like to encrypt? "</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ui<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ui<span class="token punctuation">)</span> <span class="token operator">&gt;</span> KEY_LEN<span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>

	start <span class="token operator">=</span> key_location
	stop <span class="token operator">=</span> key_location <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ui<span class="token punctuation">)</span>

	kf <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>KEY_FILE<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> stop <span class="token operator">&gt;=</span> KEY_LEN<span class="token punctuation">:</span>
		stop <span class="token operator">=</span> stop <span class="token operator">%</span> KEY_LEN
		key <span class="token operator">=</span> kf<span class="token punctuation">[</span>start<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> kf<span class="token punctuation">[</span><span class="token punctuation">:</span>stop<span class="token punctuation">]</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		key <span class="token operator">=</span> kf<span class="token punctuation">[</span>start<span class="token punctuation">:</span>stop<span class="token punctuation">]</span>
	key_location <span class="token operator">=</span> stop

	result <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> p<span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token string">"{:02x}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">^</span> k<span class="token punctuation">)</span><span class="token punctuation">,</span> ui<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Here ya go!\n{}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> key_location


<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"******************Welcome to our OTP implementation!******************"</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> startup<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> c <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
	c <span class="token operator">=</span> encrypt<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
</code></pre>
<h4 id="fonction-startup">Fonction Startup()</h4>
<p>lors du lancement du programme la fonction startup va être appelée.</p>
<p>Cette fonction va récupérer le contenu du fichier <code>FLAG_FILE</code> et du fichier <code>KEY_FILE</code>, elle va ensuite récupérer les <code>x</code> premiers charactères de la clé, clé qui fait 50000 charactères. le <code>x</code> correspond à la longueur du flag mais pour le moment on ne connait pas cette longueur. Une fois que le programme a le flag et les <code>x</code> premier charactères de la clé (que je vais appeler <strong>sous-clé</strong>), le programme va xorer chaque lettre du flag avec chaque charactères de la sous-clé, le résultat du XOR sera parser en 2 charactères hexadécimaux. Enfin le programme afficher le flag encodé avec la sous-clé et renvoyer <code>x</code> (on va voir à quoi il sert après)</p>
<h4 id="connexion-au-serveur-mercury.picoctf.net-et-retour-dexecution-de-la-fonction-startup">Connexion au serveur <code>mercury.picoctf.net</code> et retour d’execution de la fonction startup()</h4>
<pre class=" language-py"><code class="prism  language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> pwn
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> serv<span class="token operator">=</span>pwn<span class="token punctuation">.</span>remote<span class="token punctuation">(</span><span class="token string">"mercury.picoctf.net"</span><span class="token punctuation">,</span><span class="token number">36981</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>x<span class="token punctuation">]</span> Opening connection to mercury<span class="token punctuation">.</span>picoctf<span class="token punctuation">.</span>net on port <span class="token number">36981</span>
<span class="token punctuation">[</span>x<span class="token punctuation">]</span> Opening connection to mercury<span class="token punctuation">.</span>picoctf<span class="token punctuation">.</span>net on port <span class="token number">36981</span><span class="token punctuation">:</span> Trying <span class="token number">18.189</span><span class="token punctuation">.</span><span class="token number">209.142</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Opening connection to mercury<span class="token punctuation">.</span>picoctf<span class="token punctuation">.</span>net on port <span class="token number">36981</span><span class="token punctuation">:</span> Done
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> serv<span class="token punctuation">.</span>readrepeat<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
b<span class="token string">'******************Welcome to our OTP implementation!******************\nThis is the encrypted flag!\n5541103a246e415e036c4c5f0e3d415a513e4a560050644859536b4f57003d4c\n\nWhat data would you like to encrypt? '</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
</code></pre>
<p>le programme nous retourne donc <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>i</mi><mi>p</mi><mi>h</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>F</mi><mi>L</mi><mi>A</mi><mi>G</mi><mo>⊕</mo><mi>s</mi><mi>o</mi><mi>u</mi><msub><mi>s</mi><mrow><mi>c</mi><mi>l</mi><mover accent="true"><mi>e</mi><mo>ˊ</mo></mover></mrow></msub></mrow><annotation encoding="application/x-tex">cipher = FLAG ⊕ sous_{clé}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">F</span><span class="mord mathnormal">L</span><span class="mord mathnormal">A</span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord mathnormal">so</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right: 0.01968em;">l</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight">e</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.19444em;"><span class="mord mtight">ˊ</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></p>
<p>le symbole ⊕ (parfois ^) correspond à la fonction XOR</p>
<p><strong>Propritété importante du xor :</strong></p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>⊕</mo><mi>B</mi><mo>=</mo><mi>B</mi><mo>⊕</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">A ⊕ B = B ⊕ A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.05017em;">B</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathnormal" style="margin-right: 0.05017em;">B</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal">A</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>⊕</mo><mo stretchy="false">(</mo><mi>B</mi><mo>⊕</mo><mi>C</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>A</mi><mo>⊕</mo><mi>B</mi><mo stretchy="false">)</mo><mo>⊕</mo><mi>C</mi></mrow><annotation encoding="application/x-tex">A ⊕ (B ⊕ C) = (A ⊕ B) ⊕ C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.05017em;">B</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.07153em;">C</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>⊕</mo><mn>0</mn><mo>=</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">A ⊕ 0 = A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal">A</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>⊕</mo><mi>A</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">A ⊕ A = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span></p>
</blockquote>
<p>ici le cipher = <code>5541103a246e415e036c4c5f0e3d415a513e4a560050644859536b4f57003d4c</code><br>
la longeur de ce cipher  est 64, on en déduit que <code>x</code>, longeur du FLAG est <strong>32</strong></p>
<p>d’après les propriétés du XOR, pour retrouver le FLAG depuis le cipher il nous faut faire ceci :</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>i</mi><mi>p</mi><mi>h</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>F</mi><mi>L</mi><mi>A</mi><mi>G</mi><mo>⊕</mo><mi>s</mi><mi>o</mi><mi>u</mi><msub><mi>s</mi><mrow><mi>c</mi><mi>l</mi><mover accent="true"><mi>e</mi><mo>ˊ</mo></mover></mrow></msub></mrow><annotation encoding="application/x-tex">cipher=FLAG ⊕ sous_{clé}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">F</span><span class="mord mathnormal">L</span><span class="mord mathnormal">A</span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord mathnormal">so</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right: 0.01968em;">l</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight">e</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.19444em;"><span class="mord mtight">ˊ</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>i</mi><mi>p</mi><mi>h</mi><mi>e</mi><mi>r</mi><mo>⊕</mo><mi>s</mi><mi>o</mi><mi>u</mi><msub><mi>s</mi><mrow><mi>c</mi><mi>l</mi><mover accent="true"><mi>e</mi><mo>ˊ</mo></mover></mrow></msub><mo>=</mo><mi>F</mi><mi>L</mi><mi>A</mi><mi>G</mi><mo>⊕</mo><mi>s</mi><mi>o</mi><mi>u</mi><msub><mi>s</mi><mrow><mi>c</mi><mi>l</mi><mover accent="true"><mi>e</mi><mo>ˊ</mo></mover></mrow></msub><mo>⊕</mo><mi>s</mi><mi>o</mi><mi>u</mi><msub><mi>s</mi><mrow><mi>c</mi><mi>l</mi><mover accent="true"><mi>e</mi><mo>ˊ</mo></mover></mrow></msub></mrow><annotation encoding="application/x-tex">cipher ⊕ sous_{clé} =FLAG ⊕ sous_{clé} ⊕ sous_{clé}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord mathnormal">so</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right: 0.01968em;">l</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight">e</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.19444em;"><span class="mord mtight">ˊ</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">F</span><span class="mord mathnormal">L</span><span class="mord mathnormal">A</span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.73333em; vertical-align: -0.15em;"></span><span class="mord mathnormal">so</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right: 0.01968em;">l</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight">e</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.19444em;"><span class="mord mtight">ˊ</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord mathnormal">so</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right: 0.01968em;">l</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight">e</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.19444em;"><span class="mord mtight">ˊ</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>i</mi><mi>p</mi><mi>h</mi><mi>e</mi><mi>r</mi><mo>⊕</mo><mi>s</mi><mi>o</mi><mi>u</mi><msub><mi>s</mi><mrow><mi>c</mi><mi>l</mi><mover accent="true"><mi>e</mi><mo>ˊ</mo></mover></mrow></msub><mo>=</mo><mi>F</mi><mi>L</mi><mi>A</mi><mi>G</mi><mo>⊕</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">cipher ⊕ sous_{clé} =FLAG ⊕ 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord mathnormal">so</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right: 0.01968em;">l</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight">e</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.19444em;"><span class="mord mtight">ˊ</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">F</span><span class="mord mathnormal">L</span><span class="mord mathnormal">A</span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>i</mi><mi>p</mi><mi>h</mi><mi>e</mi><mi>r</mi><mo>⊕</mo><mi>s</mi><mi>o</mi><mi>u</mi><msub><mi>s</mi><mrow><mi>c</mi><mi>l</mi><mover accent="true"><mi>e</mi><mo>ˊ</mo></mover></mrow></msub><mo>=</mo><mi>F</mi><mi>L</mi><mi>A</mi><mi>G</mi></mrow><annotation encoding="application/x-tex">cipher ⊕ sous_{clé} =FLAG</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord mathnormal">so</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right: 0.01968em;">l</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mathnormal mtight">e</span></span><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="accent-body" style="left: -0.19444em;"><span class="mord mtight">ˊ</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.13889em;">F</span><span class="mord mathnormal">L</span><span class="mord mathnormal">A</span><span class="mord mathnormal">G</span></span></span></span></span></p>
</blockquote>
<p>le but est maintenant de connaitre la sous-clé. pour cela il nous faut comprendre la deuxième partie du programme.</p>
<h4 id="fonction-encrypt">Fonction Encrypt()</h4>
<p>la fonction Encrypt() demande à l’utilisateur d’entrer une chaine de charactères. Cette chaine de charactères sera alors encryptée de la même manière que le flag <strong>mais avec un morceau de la clé différente</strong>. Je m’explique. Prenons une clé de longueur 10 et un flag de longueur 2. lors de la fonction startup le chiffrement se fait comme cela:</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>l</mi><mi>a</mi><mi>g</mi><mo>=</mo><mi>a</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">flag = ab</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.10764em;">f</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">ab</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi><mi>y</mi><mo>=</mo><mi>a</mi><mi>b</mi><mi>c</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>g</mi><mi>h</mi><mi>i</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">key = abcdefghij</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.03148em;">k</span><span class="mord mathnormal" style="margin-right: 0.03588em;">ey</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">ab</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.10764em;">f</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal" style="margin-right: 0.05724em;">hij</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>i</mi><mi>p</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo>=</mo><mi>x</mi><mi>x</mi><mo>⊕</mo><mi>a</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">ciphertext = xx ⊕ ab</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathnormal">xx</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">ab</span></span></span></span></span></p>
</blockquote>
<p>pour la suite, si la chaine de charactère que nous voulons chiffrer fait 4 charactères alors :</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><msub><mi>t</mi><mrow><mi>u</mi><mi>s</mi><mi>e</mi><mi>r</mi></mrow></msub><mo>=</mo><mi>a</mi><mi>b</mi><mi>c</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">input_{user} = abcd</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right: 0.02778em;">ser</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">ab</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi><mi>y</mi><mo>=</mo><mi>a</mi><mi>b</mi><mi>c</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>g</mi><mi>h</mi><mi>i</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">key = abcdefghij</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.03148em;">k</span><span class="mord mathnormal" style="margin-right: 0.03588em;">ey</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">ab</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.10764em;">f</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class="mord mathnormal" style="margin-right: 0.05724em;">hij</span></span></span></span></span><br>
<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>i</mi><mi>p</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo>=</mo><mi>a</mi><mi>b</mi><mi>c</mi><mi>d</mi><mo>⊕</mo><mi>c</mi><mi>d</mi><mi>e</mi><mi>f</mi></mrow><annotation encoding="application/x-tex">ciphertext = abcd ⊕ cdef</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right: 0.02778em;">er</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.77777em; vertical-align: -0.08333em;"></span><span class="mord mathnormal">ab</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.10764em;">f</span></span></span></span></span></p>
</blockquote>
<p>à chaque fois nous chiffrons notre chaine de charactères avec la suite de la clé sans réutiliser ce qui a déjà été utilisé pour chiffrer une ancienne chaine de charactère. là est le problème principal : <strong>comment récupérer la valeur des 32 premiers charactères de la clé</strong></p>
<p>on va réussir à le faire grâce à ce bout de code, présent dans la fonction encrypt() :</p>
<pre class=" language-py"><code class="prism  language-py">start <span class="token operator">=</span> key_location
stop <span class="token operator">=</span> key_location <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ui<span class="token punctuation">)</span>

<span class="token keyword">if</span> stop <span class="token operator">&gt;=</span> KEY_LEN<span class="token punctuation">:</span> 
	stop <span class="token operator">=</span> stop <span class="token operator">%</span> KEY_LEN 
	key <span class="token operator">=</span> kf<span class="token punctuation">[</span>start<span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token operator">+</span> kf<span class="token punctuation">[</span><span class="token punctuation">:</span>stop<span class="token punctuation">]</span>  
<span class="token keyword">else</span><span class="token punctuation">:</span> 
	key <span class="token operator">=</span> kf<span class="token punctuation">[</span>start<span class="token punctuation">:</span>stop<span class="token punctuation">]</span> 
key_location <span class="token operator">=</span> stop
</code></pre>
<p>ici la variable <code>key_location</code> contient l’index du dernier charactère de la dernière sous-clé utilisé. c’est cette variable qui permet de savoir ou démarre la prochaine sous-clé (d’où le <code>start</code>). le <code>stop</code>, quant à lui, contient le <code>start</code> + la longueur de la chaine de charactères que nous voulons chiffrer. Cependant, si <code>stop</code> est supérieur à la longueur de la clé (50000 charactères), alors, <strong>on retourne au départ de la clé !!</strong>. Étant donné qu’après la fonction startup, la <code>key_location</code> est à 32, il nous est possible de demander au programme de chiffrer 50000-32 caractères. De cette manière, la prochaine fois que nous chiffrerons, nous récupèrerons les premiers charactères de la clé.</p>
<h3 id="théorie-de-la-solution">Théorie de la solution</h3>
<p>Nous n’avons pas tout à fait terminé c’est bien beau de savoir qu’on peut chiffrer une chaine de charactère avec les 32 premiers charactères de la clé mais ce qu’on veut c’est les 32 premiers charactères de la clé pas un cyphertext. Et ça, eh bien c’est possible grâce à une des propriétés du XOR :</p>
<blockquote>
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>⊕</mo><mn>0</mn><mo>=</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">A ⊕ 0 = A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathnormal">A</span></span></span></span></span></p>
</blockquote>
<p>il nous suffit d’envoyer 32 fois le bytes b’\x00’ et le programme nous retournera un ciphertext hexadécimal de 64 charactères dont il sera très facile de retirer la clé.</p>
<p>Reste donc un tout dernier point avant la mise en pratique, comment depuis mon ciphertext hexadécimal de 64 charactères contenant la clé et mon ciphertext hexadécimal de 64 charactères contenant la clé xorer avec le flag, je récupère le flag. Cela est simple. Il est en effet assez simple de prendre 2 par 2 les lettres du ciphertext et de les convertir en bytes.</p>
<h3 id="mise-en-pratique">Mise en pratique</h3>
<pre class=" language-py"><code class="prism  language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> pwn
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> serv <span class="token operator">=</span> pwn<span class="token punctuation">.</span>remote<span class="token punctuation">(</span><span class="token string">"mercury.picoctf.net"</span><span class="token punctuation">,</span><span class="token number">36981</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>x<span class="token punctuation">]</span> Opening connection to mercury<span class="token punctuation">.</span>picoctf<span class="token punctuation">.</span>net on port <span class="token number">36981</span>
<span class="token punctuation">[</span>x<span class="token punctuation">]</span> Opening connection to mercury<span class="token punctuation">.</span>picoctf<span class="token punctuation">.</span>net on port <span class="token number">36981</span><span class="token punctuation">:</span> Trying <span class="token number">18.189</span><span class="token punctuation">.</span><span class="token number">209.142</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Opening connection to mercury<span class="token punctuation">.</span>picoctf<span class="token punctuation">.</span>net on port <span class="token number">36981</span><span class="token punctuation">:</span> Done
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> serv<span class="token punctuation">.</span>readrepeat<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
b<span class="token string">'******************Welcome to our OTP implementation!******************\nThis is the encrypted flag!\n5541103a246e415e036c4c5f0e3d415a513e4a560050644859536b4f57003d4c\n\nWhat data would you like to encrypt? '</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> serv<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>b<span class="token string">'\x00'</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> serv<span class="token punctuation">.</span>readrepeat<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token string">'un truc trop long'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> serv<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>b<span class="token string">'\x00'</span><span class="token operator">*</span><span class="token number">32</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> serv<span class="token punctuation">.</span>readrepeat<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
b<span class="token string">'Here ya go!\n6227295e455c7838375c7866375c7862355c786430635c7838665c7863365c78\n\nWhat data would you like to encrypt? '</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
</code></pre>
<p>ciphertext_flag = <code>5541103a246e415e036c4c5f0e3d415a513e4a560050644859536b4f57003d4c</code><br>
ciphertext_key = <code>6227295e455c7838375c7866375c7862355c786430635c7838665c7863365c78</code></p>
<pre class=" language-py"><code class="prism  language-py"><span class="token keyword">def</span> <span class="token function">TwoTime_Pad_XOR_hex</span><span class="token punctuation">(</span>hexa<span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">buffer</span> <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>hexa<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        char_flag <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>hexa<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
        char_key  <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
        <span class="token builtin">buffer</span> <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>char_flag <span class="token operator">^</span><span class="token operator">^</span>char_key<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">buffer</span>
</code></pre>
<p>en utilisant ce programme je peux inverser le chiffrement utilisé dans le programme de base. je convertis mes valeurs hexa de 64 charactères en chaine de charactère de 32 charactères et xor leurs lettres.</p>
<h4 id="execution-du-decryptage">Execution du decryptage</h4>
<pre class=" language-py"><code class="prism  language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> mylib <span class="token keyword">as</span> crypto
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c_flag <span class="token operator">=</span> <span class="token string">"5541103a246e415e036c4c5f0e3d415a513e4a560050644859536b4f57003d4c"</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c_key <span class="token operator">=</span> <span class="token string">"6227295e455c7838375c7866375c7862355c786430635c7838665c7863365c78"</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> crypto<span class="token punctuation">.</span>TwoTime_Pad_XOR_hex<span class="token punctuation">(</span>c_flag<span class="token punctuation">,</span>c_key<span class="token punctuation">)</span>
<span class="token string">'7f9da29f40499a98db220380a57746a4'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
</code></pre>
<hr>
<p>Flag : <code>picoCTF{7f9da29f40499a98db220380a57746a4}</code></p>
<p>Auteur : <code>ℜ𝔬𝔪#8216</code></p>
</div>
</body>

</html>
